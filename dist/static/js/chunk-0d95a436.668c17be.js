(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0d95a436","chunk-7ef83241","chunk-3e8cbbbc","chunk-90f6832e","chunk-31631b6a","chunk-5e04f6b8","chunk-290360f9"],{"05ba":function(t,e){var i="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(i){var a=new Uint8Array(16);t.exports=function(){return i(a),a}}else{var s=new Array(16);t.exports=function(){for(var t,e=0;e<16;e++)0===(3&e)&&(t=4294967296*Math.random()),s[e]=t>>>((3&e)<<3)&255;return s}}},"0716":function(t,e,i){"use strict";var a=i("9ddb"),s=i.n(a);s.a},"0ce2":function(t,e,i){"use strict";var a=i("5ffa"),s=i.n(a);s.a},"0e43":function(t,e,i){},"1cd6":function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"index"},[i("div",{staticClass:"tabs"},t._l(t.tabs,function(e,a){return i("div",{staticClass:"tab",class:{active:t.activeTab===a},on:{click:function(e){return t.selectTab(a)}}},[t._v(t._s(e.name))])}),0),i("div",{staticClass:"index-container"},[i("assist",{directives:[{name:"show",rawName:"v-show",value:0===t.activeTab,expression:"activeTab === 0"}]}),i("material-store",{directives:[{name:"show",rawName:"v-show",value:1===t.activeTab,expression:"activeTab === 1"}]}),i("my-material",{directives:[{name:"show",rawName:"v-show",value:2===t.activeTab,expression:"activeTab === 2"}]})],1)])},s=[],n=i("1da1"),c=i("97c8"),r=i("c6c1"),o={name:"material",data:function(){return{tabs:[{name:"辅助效果"},{name:"素材库"},{name:"我的素材"}],activeTab:0}},methods:{selectTab:function(t){this.activeTab=t}},components:{assist:n["default"],materialStore:c["default"],myMaterial:r["default"]}},l=o,d=(i("ec25"),i("17cc")),u=Object(d["a"])(l,a,s,!1,null,"6387ee73",null);e["default"]=u.exports},"1da1":function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"assist"},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.title,expression:"title"}],staticClass:"assist-back",on:{click:t.back}},[i("i",{staticClass:"icon-back-1"}),i("span",[t._v(t._s(t.title))])]),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.showBack,expression:"!showBack"}],staticClass:"assist-options"},[i("div",{staticClass:"assist-options-item",on:{click:t.addText}},[i("touch-ripple",{attrs:{speed:3,opacity:.6}},[i("div",{staticClass:"item-icon icon-text"}),i("div",{staticClass:"item-name"},[t._v("添加文本")])])],1),t._l(t.options,function(e){return i("div",{staticClass:"assist-options-item",on:{click:function(i){return t.selectOption(e)}}},[i("touch-ripple",{attrs:{speed:3,opacity:.6}},[i("div",{staticClass:"item-icon",class:e.icon}),i("div",{staticClass:"item-name"},[t._v(t._s(e.name))])])],1)})],2),i("div",{staticClass:"assist-contaienr"},[i("transition",{attrs:{name:"material"}},[t.showBack?i("infinite-scroll",{staticClass:"assist-list",attrs:{loadMore:t.loadMore}},t._l(t.assists,function(e){return i("div",{staticClass:"assist-item",class:{"light-item":e.border_color},style:{"background-color":e.background,"border-color":e.border_color},on:{click:function(i){return t.addMaterial(e.img,e)}}},[i("div",{staticClass:"assist-item-img",style:{"background-image":"url("+e.img+"?imageslim&imageView2/0/w/268)"}})])}),0):t._e()],1)],1)])},s=[],n=i("4964"),c=(i("7364"),i("4453"),i("089b")),r=i("e20c"),o=i("880a"),l=i("5428"),d=i.n(l),u=i("591a"),v=i("fd88"),m={name:"assist",data:function(){return{showBack:!1,lightShow:!1,title:"",selectId:null,assists:[],isLoading:!1,isLoaded:!1,pageCode:0,options:[]}},components:{infiniteScroll:v["a"]},methods:Object(r["a"])({},Object(u["b"])(["updateHistory"]),{init:function(){var t=Object(c["a"])(regeneratorRuntime.mark(function t(){var e,i,a;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.$axios.get(o["getClassify"]);case 3:e=t.sent,i=e.data,this.options=i.lower,t.next=12;break;case 8:t.prev=8,t.t0=t["catch"](0),a=t.t0.msg,this.$toast.error(a);case 12:case"end":return t.stop()}},t,this,[[0,8]])}));function e(){return t.apply(this,arguments)}return e}(),selectOption:function(t){this.showBack=!0,this.assists=[],this.selectId=t.id,this.title=t.name,this.getMaterial()},getMaterial:function(){var t=Object(c["a"])(regeneratorRuntime.mark(function t(){var e,i,a;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.$axios.get(o["classifyMaterial"],{params:{id:this.selectId,page_size:28}});case 3:e=t.sent,i=e.data,this.pageCode=i.page_code,this.assists=i.ls,t.next=13;break;case 9:t.prev=9,t.t0=t["catch"](0),a=t.t0.msg,this.$toast.error(a);case 13:case"end":return t.stop()}},t,this,[[0,9]])}));function e(){return t.apply(this,arguments)}return e}(),back:function(){this.title="",this.showBack=!1},addText:function(){var t=d()(),e=new fabric.IText("双击修改文字",{left:100,top:100,cornerSize:20,padding:5,fill:"rgba(0, 0, 0, 1)",uid:t});canvas.add(e),canvas.setActiveObject(e)},addMaterial:function(t,e){var i=this,a=d()();fabric.Image.fromURL(t+"?imageslim&imageView2/0/w/1000",function(t){t.set({id:e.id,left:100,top:100,uid:a}),t.scaleToWidth(300),canvas.add(t),canvas.setActiveObject(t),i.updateHistory()},{crossOrigin:"anonymous"})},loadMore:function(){var t=Object(c["a"])(regeneratorRuntime.mark(function t(){var e,i,a,s,c=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,!this.isLoading&&!this.isLoaded){t.next=3;break}return t.abrupt("return");case 3:return this.isLoading=!0,t.next=6,this.$axios.get(o["classifyMaterial"],{params:{id:this.selectId,page_code:this.pageCode,page_size:28}});case 6:i=t.sent,a=i.data,this.pageCode=a.page_code,(e=this.assists).push.apply(e,Object(n["a"])(a.ls)),a.ls.length||(this.isLoaded=!0),this.$nextTick(function(){c.isLoading=!1}),t.next=18;break;case 14:t.prev=14,t.t0=t["catch"](0),s=t.t0.msg,this.$toast.error(s);case 18:case"end":return t.stop()}},t,this,[[0,14]])}));function e(){return t.apply(this,arguments)}return e}()}),created:function(){this.init()}},h=m,p=(i("0ce2"),i("17cc")),g=Object(p["a"])(h,a,s,!1,null,"30046279",null);e["default"]=g.exports},"37ea":function(t,e,i){},"3c6b":function(t,e,i){"use strict";var a=i("a013"),s=i("b146"),n=i("b0f4"),c=i("35dd");i("629c")("match",1,function(t,e,i,r){return[function(i){var a=t(this),s=void 0==i?void 0:i[e];return void 0!==s?s.call(i,a):new RegExp(i)[e](String(a))},function(t){var e=r(i,t,this);if(e.done)return e.value;var o=a(t),l=String(this);if(!o.global)return c(o,l);var d=o.unicode;o.lastIndex=0;var u,v=[],m=0;while(null!==(u=c(o,l))){var h=String(u[0]);v[m]=h,""===h&&(o.lastIndex=n(l,s(o.lastIndex),d)),m++}return 0===m?null:v}]})},4964:function(t,e,i){"use strict";function a(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}function s(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function n(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function c(t){return a(t)||s(t)||n()}i.d(e,"a",function(){return c})},5428:function(t,e,i){var a=i("05ba"),s=i("97c1");function n(t,e,i){var n=e&&i||0;"string"==typeof t&&(e="binary"===t?new Array(16):null,t=null),t=t||{};var c=t.random||(t.rng||a)();if(c[6]=15&c[6]|64,c[8]=63&c[8]|128,e)for(var r=0;r<16;++r)e[n+r]=c[r];return e||s(c)}t.exports=n},"5ffa":function(t,e,i){},"7aae":function(t,e,i){},9056:function(t,e,i){"use strict";var a=i("0e43"),s=i.n(a);s.a},"97c1":function(t,e){for(var i=[],a=0;a<256;++a)i[a]=(a+256).toString(16).substr(1);function s(t,e){var a=e||0,s=i;return[s[t[a++]],s[t[a++]],s[t[a++]],s[t[a++]],"-",s[t[a++]],s[t[a++]],"-",s[t[a++]],s[t[a++]],"-",s[t[a++]],s[t[a++]],"-",s[t[a++]],s[t[a++]],s[t[a++]],s[t[a++]],s[t[a++]],s[t[a++]]].join("")}t.exports=s},"97c8":function(t,e,i){"use strict";i.r(e);var a,s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{ref:"materials",staticClass:"material"},[a("div",{staticClass:"filter"},[a("div",{staticClass:"select"},[a("div",{staticClass:"select-value",on:{click:function(e){return e.stopPropagation(),t.toggleSpaceSelect(e)}}},[t._v(t._s(t.selectedSpace||"选择空间"))]),a("transition",{attrs:{name:"expand"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.spaceSelect,expression:"spaceSelect"}],staticClass:"select-dropdown"},[a("div",{staticClass:"select-option",on:{click:function(e){return t.selectSpace("")}}},[t._v("全部")]),t._l(t.spaceList,function(e){return a("div",{staticClass:"select-option",class:{active:t.selectedSpace===e.name},on:{click:function(i){return t.selectSpace(e.name)}}},[t._v(t._s(e.name))])})],2)])],1),a("div",{staticClass:"select"},[a("div",{staticClass:"select-value",on:{click:function(e){return e.stopPropagation(),t.toggleStyleSelect(e)}}},[t._v(t._s(t.selectedStyle||"选择风格"))]),a("transition",{attrs:{name:"expand"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.styleSelect,expression:"styleSelect"}],staticClass:"select-dropdown"},[a("div",{staticClass:"select-option",on:{click:function(e){return t.selectStyle("")}}},[t._v("全部")]),t._l(t.styleList,function(e){return a("div",{staticClass:"select-option",class:{active:t.selectedStyle===e.name},on:{click:function(i){return t.selectStyle(e.name)}}},[t._v(t._s(e.name))])})],2)])],1)]),a("div",{staticClass:"material-container"},[t.list.length?a("infiniteScroll",{staticClass:"material-list",attrs:{loadMore:t.loadMore}},t._l(t.list,function(e){return a("div",{staticClass:"material-item"},[a("div",{staticClass:"material-item-img",style:{"background-image":"url("+e.img+"?imageslim&imageView2/0/w/765)"},attrs:{id:e.id,type:"material"}}),a("div",{staticClass:"material-item-cell"},[a("div",{staticClass:"material-item-info"},[t._v("点击添加到画布…")]),a("div",{staticClass:"material-item-collection",on:{click:function(i){return i.stopPropagation(),t.collectionMaterial(e)}}},[e.is_collection?a("i",{staticClass:"icon-collection_active"}):a("i",{staticClass:"icon-collection"})])]),a("div",{staticClass:"material-item-btns"},[a("div",{staticClass:"material-item-btn",on:{click:function(i){return t.replaceImage(e.img)}}},[t._v("替换")]),a("div",{staticClass:"material-item-btn",on:{click:function(i){return t.addImage(e.img)}}},[t._v("添加")])])])}),0):a("div",{staticClass:"material-list"},[a("div",{staticClass:"material-list-info"},[a("img",{attrs:{src:i("d363")}}),a("div",{staticClass:"material-list-info-txt"},[t._v("未找到相关案例")])])])],1)])},n=[],c=(i("f763"),i("608b"),i("3c6b"),i("4964")),r=(i("4453"),i("089b")),o=i("e20c"),l=i("880a"),d=i("fd88"),u=i("591a"),v=i("5428"),m=i.n(v),h={name:"materialStore",data:function(){return{list:[],pageCode:0,isLoading:!1,isLoaded:!1,spaceSelect:!1,styleSelect:!1,selectedStyle:"",selectedSpace:"",eventList:{TOUCH_START:this.isMobile()?"touchstart":"mousedown",TOUCH_MOVE:this.isMobile()?"touchmove":"mousemove",TOUCH_END:this.isMobile()?"touchend":"mouseup"}}},components:{infiniteScroll:d["a"]},watch:{selectedStyle:function(){this.getSceneMaterials()},selectedSpace:function(){this.getSceneMaterials()}},methods:Object(o["a"])({},Object(u["b"])(["changeSketchGoods","updateHistory"]),{collectionMaterial:function(){var t=Object(r["a"])(regeneratorRuntime.mark(function t(e){var i,a,s;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,i=e.is_collection,a=e.id,!i){t.next=7;break}return t.next=5,this.$axios.get(l["unCollectionMaterial"],{params:{id:a}});case 5:t.next=9;break;case 7:return t.next=9,this.$axios.get(l["collectionMaterial"],{params:{id:a}});case 9:this.$set(e,"is_collection",!i),t.next=16;break;case 12:t.prev=12,t.t0=t["catch"](0),s=t.t0.msg,this.$toast.error(s);case 16:case"end":return t.stop()}},t,this,[[0,12]])}));function e(e){return t.apply(this,arguments)}return e}(),selectSpace:function(t){this.selectedSpace=t},selectStyle:function(t){this.selectedStyle=t},toggleSpaceSelect:function(){this.spaceSelect=!this.spaceSelect},toggleStyleSelect:function(){this.styleSelect=!this.styleSelect},getSceneMaterials:function(){var t=Object(r["a"])(regeneratorRuntime.mark(function t(){var e,i,a;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.$axios.get(l["getSceneMaterials"],{params:{my:0,style:this.selectedStyle,space:this.selectedSpace}});case 3:e=t.sent,i=e.data,this.pageCode=i.page_code,this.list=i.ls,this.isLoaded=!1,t.next=14;break;case 10:t.prev=10,t.t0=t["catch"](0),a=t.t0.msg,this.$toast.error(a);case 14:case"end":return t.stop()}},t,this,[[0,10]])}));function e(){return t.apply(this,arguments)}return e}(),loadMore:function(){var t=Object(r["a"])(regeneratorRuntime.mark(function t(){var e,i,a,s;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,!this.isLoading&&!this.isLoaded){t.next=3;break}return t.abrupt("return");case 3:return this.isLoading=!0,t.next=6,this.$axios.get(l["getSceneMaterials"],{params:{my:0,page_code:this.pageCode,style:this.selectedStyle,space:this.selectedSpace}});case 6:i=t.sent,a=i.data,(e=this.list).push.apply(e,Object(c["a"])(a.ls)),this.pageCode=a.page_code,this.isLoaded=!a.ls.length,this.isLoading=!1,t.next=19;break;case 14:t.prev=14,t.t0=t["catch"](0),s=t.t0.msg,this.isLoading=!1,this.$toast.error(s);case 19:case"end":return t.stop()}},t,this,[[0,14]])}));function e(){return t.apply(this,arguments)}return e}(),isMobile:function(){return!!(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i))},initDrag:function(){var t=this,e=new CustomEvent("mydragstart"),i=new CustomEvent("mydragend");this.$refs.materials.addEventListener(this.eventList.TOUCH_START,function(s){if(s.cancelable&&-1!==s.target.className.indexOf("material-item-img")){clearInterval(a);var n=500,c=t.isMobile()?s.changedTouches[0]:s,r=null,l=s.target,d=l.getBoundingClientRect(),u=!1,v=null;a=setTimeout(function(){window.dispatchEvent(e),r=l.cloneNode(!0),r.style.width=l.offsetWidth+"px",r.style.height=l.offsetHeight+"px",r.style.position="fixed",r.style.left=d.left+"px",r.style.top=d.top+"px",r.style.pointerEvents="none",r.style.transition="transform .3s",document.body.appendChild(r),setTimeout(function(){r.style.transform="scale(1.2)"},50);var i=function t(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,e.target.removeEventListener("click",t)},a=function(t){t.preventDefault()},s=function e(i){i.preventDefault(),i.target.removeEventListener(t.eventList.TOUCH_MOVE,a),i.target.removeEventListener(t.eventList.TOUCH_END,e)};l.addEventListener("click",i),l.addEventListener(t.eventList.TOUCH_MOVE,a),l.addEventListener(t.eventList.TOUCH_END,s)},n);var m=function(e){var i=t.isMobile()?e.changedTouches[0]:e;(Math.abs(i.clientX-c.clientX)>30||Math.abs(i.clientY-c.clientY)>30)&&clearInterval(a),requestAnimationFrame(function(){if(r){var i=t.isMobile()?e.changedTouches[0]:e,a=document.createEvent("Event");a.initEvent("myDragover",!0,!0),v=document.elementFromPoint(i.pageX,i.pageY),v&&v.dispatchEvent(a),u=a.defaultPrevented,r.style.left=Math.round(i.pageX-(c.pageX-d.left))+"px",r.style.top=Math.round(i.pageY-(c.pageY-d.top))+"px"}})};document.addEventListener(t.eventList.TOUCH_MOVE,m,{passive:!1}),document.addEventListener(t.eventList.TOUCH_END,function(e){if(clearInterval(a),document.removeEventListener(t.eventList.TOUCH_MOVE,m),r){if(u){var s=document.createEvent("Event");s.initEvent("myDrop",!0,!0);var n=t.isMobile()?e.changedTouches[0]:e,c=t.list.find(function(t){return parseInt(l.getAttribute("id"))===t.id});s["pageX"]=n.pageX,s["pageY"]=n.pageY,s["data"]=Object(o["a"])({type:l.getAttribute("type"),url:c.img},c),v.dispatchEvent(s)}document.body.removeChild(r),r=null,window.dispatchEvent(i)}})}})},handleDragEnd:function(t){window.dispatchEvent(window.mydragend),window.dragTarget=null},handleDragStart:function(t,e){t.dataTransfer.setData("type","material"),t.dataTransfer.setData("url",e.img),window.dispatchEvent(window.mydragstart)},replaceImage:function(t){var e=this,i=canvas.getActiveObjects();if(this.matrixShow)this.$toast.message("请先取消变形");else if(0!==i.length)if(i.length>1)this.$toast.message("只能替换单个素材");else if("i-text"!==i[0].type){var a=m()();canvas.getActiveObjects().forEach(function(t){t.goods_id&&e.changeSketchGoods({type:"remove",uid:t.uid}),canvas.remove(t)}),canvas.discardActiveObject().renderAll(),fabric.Image.fromURL(t+"?imageslim&imageView2/0/w/1000",function(t){var s=i[0].scaleX*i[0].width/t.width,n=Object(o["a"])({},i[0],{width:t.width,height:t.height,scaleX:s,scaleY:s,_element:t._element,_originalElement:t._originalElement,uid:a});n.goods_id&&delete n.goods_id,t.set(Object(o["a"])({},n)),canvas.add(t),canvas.setActiveObject(t),e.updateHistory()},{crossOrigin:"anonymous"})}else this.$toast.message("文本不能被替换");else this.$toast.message("请先选中被替换的素材")},addImage:function(t){var e=this,i=m()();fabric.Image.fromURL(t+"?imageslim&imageView2/0/w/1000",function(t){t.set({uid:i}),canvas.add(t),canvas.setActiveObject(t),e.updateHistory()},{crossOrigin:"anonymous"})}}),computed:Object(o["a"])({},Object(u["c"])({styleList:function(t){return t.sketch.styleList},spaceList:function(t){return t.sketch.spaceList},matrixShow:function(t){return t.sketch.matrix.show}})),created:function(){this.getSceneMaterials()},mounted:function(){var t=this;document.addEventListener("click",function(){t.spaceSelect=!1,t.styleSelect=!1}),this.initDrag()}},p=h,g=(i("9056"),i("17cc")),f=Object(g["a"])(p,s,n,!1,null,"cc6b19f4",null);e["default"]=f.exports},"9ddb":function(t,e,i){},c2f0:function(t,e,i){"use strict";var a=i("37ea"),s=i.n(a);s.a},c6c1:function(t,e,i){"use strict";i.r(e);var a,s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{ref:"materials",staticClass:"material"},[a("div",{staticClass:"filter"},[a("div",{staticClass:"select"},[a("div",{staticClass:"select-value",on:{click:function(e){return e.stopPropagation(),t.toggleSpaceSelect(e)}}},[t._v(t._s(t.selectedSpace||"选择空间"))]),a("transition",{attrs:{name:"expand"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.spaceSelect,expression:"spaceSelect"}],staticClass:"select-dropdown"},[a("div",{staticClass:"select-option",on:{click:function(e){return t.selectSpace("")}}},[t._v("全部")]),t._l(t.spaceList,function(e){return a("div",{staticClass:"select-option",class:{active:t.selectedSpace===e.name},on:{click:function(i){return t.selectSpace(e.name)}}},[t._v(t._s(e.name))])})],2)])],1),a("div",{staticClass:"select"},[a("div",{staticClass:"select-value",on:{click:function(e){return e.stopPropagation(),t.toggleStyleSelect(e)}}},[t._v(t._s(t.selectedStyle||"选择风格"))]),a("transition",{attrs:{name:"expand"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.styleSelect,expression:"styleSelect"}],staticClass:"select-dropdown"},[a("div",{staticClass:"select-option",on:{click:function(e){return t.selectStyle("")}}},[t._v("全部")]),t._l(t.styleList,function(e){return a("div",{staticClass:"select-option",class:{active:t.selectedStyle===e.name},on:{click:function(i){return t.selectStyle(e.name)}}},[t._v(t._s(e.name))])})],2)])],1)]),a("div",{staticClass:"material-container"},[t.list.length?a("infiniteScroll",{staticClass:"material-list",attrs:{loadMore:t.loadMore}},t._l(t.list,function(e){return a("div",{staticClass:"material-item"},[a("div",{staticClass:"material-item-img",style:{"background-image":"url("+e.img+"?imageslim&imageView2/0/w/765)"},attrs:{id:e.id,type:"material"}}),a("div",{staticClass:"material-item-cell"},[a("div",{staticClass:"material-item-info"},[t._v("点击添加到画布…")]),a("div",{staticClass:"material-item-collection",on:{click:function(i){return i.stopPropagation(),t.collectionMaterial(e)}}},[e.is_collection?a("i",{staticClass:"icon-collection_active"}):a("i",{staticClass:"icon-collection"})])]),a("div",{staticClass:"material-item-btns"},[a("div",{staticClass:"material-item-btn",on:{click:function(i){return t.replaceImage(e.img)}}},[t._v("替换")]),a("div",{staticClass:"material-item-btn",on:{click:function(i){return t.addImage(e.img)}}},[t._v("添加")])])])}),0):a("div",{staticClass:"material-list"},[a("div",{staticClass:"material-list-info"},[a("img",{attrs:{src:i("d363")}}),a("div",{staticClass:"material-list-info-txt"},[t._v("未找到相关素材")])])])],1)])},n=[],c=(i("f763"),i("608b"),i("3c6b"),i("4964")),r=(i("4453"),i("089b")),o=i("e20c"),l=i("880a"),d=i("fd88"),u=i("591a"),v=i("5428"),m=i.n(v),h={name:"myMaterial",data:function(){return{list:[],pageCode:0,isLoading:!1,isLoaded:!1,spaceSelect:!1,styleSelect:!1,selectedStyle:"",selectedSpace:"",eventList:{TOUCH_START:this.isMobile()?"touchstart":"mousedown",TOUCH_MOVE:this.isMobile()?"touchmove":"mousemove",TOUCH_END:this.isMobile()?"touchend":"mouseup"}}},components:{infiniteScroll:d["a"]},watch:{selectedStyle:function(){this.getSceneMaterials()},selectedSpace:function(){this.getSceneMaterials()}},methods:Object(o["a"])({},Object(u["b"])(["changeSketchGoods","updateHistory"]),{collectionMaterial:function(){var t=Object(r["a"])(regeneratorRuntime.mark(function t(e){var i,a,s;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,i=e.is_collection,a=e.id,!i){t.next=7;break}return t.next=5,this.$axios.get(l["unCollectionMaterial"],{params:{id:a}});case 5:t.next=9;break;case 7:return t.next=9,this.$axios.get(l["collectionMaterial"],{params:{id:a}});case 9:this.$set(e,"is_collection",!i),t.next=16;break;case 12:t.prev=12,t.t0=t["catch"](0),s=t.t0.msg,this.$toast.error(s);case 16:case"end":return t.stop()}},t,this,[[0,12]])}));function e(e){return t.apply(this,arguments)}return e}(),selectSpace:function(t){this.selectedSpace=t},selectStyle:function(t){this.selectedStyle=t},toggleSpaceSelect:function(){this.spaceSelect=!this.spaceSelect},toggleStyleSelect:function(){this.styleSelect=!this.styleSelect},getSceneMaterials:function(){var t=Object(r["a"])(regeneratorRuntime.mark(function t(){var e,i,a;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.$axios.get(l["getSceneMaterials"],{params:{my:1,style:this.selectedStyle,space:this.selectedSpace}});case 3:e=t.sent,i=e.data,this.pageCode=i.page_code,this.list=i.ls,this.isLoaded=!1,t.next=14;break;case 10:t.prev=10,t.t0=t["catch"](0),a=t.t0.msg,this.$toast.error(a);case 14:case"end":return t.stop()}},t,this,[[0,10]])}));function e(){return t.apply(this,arguments)}return e}(),loadMore:function(){var t=Object(r["a"])(regeneratorRuntime.mark(function t(){var e,i,a,s;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,!this.isLoading&&!this.isLoaded){t.next=3;break}return t.abrupt("return");case 3:return this.isLoading=!0,t.next=6,this.$axios.get(l["getSceneMaterials"],{params:{my:1,page_code:this.pageCode,style:this.selectedStyle,space:this.selectedSpace}});case 6:i=t.sent,a=i.data,(e=this.list).push.apply(e,Object(c["a"])(a.ls)),this.pageCode=a.page_code,this.isLoaded=!a.ls.length,this.isLoading=!1,t.next=19;break;case 14:t.prev=14,t.t0=t["catch"](0),s=t.t0.msg,this.isLoading=!1,this.$toast.error(s);case 19:case"end":return t.stop()}},t,this,[[0,14]])}));function e(){return t.apply(this,arguments)}return e}(),isMobile:function(){return!!(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i))},initDrag:function(){var t=this,e=new CustomEvent("mydragstart"),i=new CustomEvent("mydragend");this.$refs.materials.addEventListener(this.eventList.TOUCH_START,function(s){if(s.cancelable&&-1!==s.target.className.indexOf("material-item-img")){clearInterval(a);var n=500,c=t.isMobile()?s.changedTouches[0]:s,r=null,l=s.target,d=l.getBoundingClientRect(),u=!1,v=null;a=setTimeout(function(){window.dispatchEvent(e),r=l.cloneNode(!0),r.style.width=l.offsetWidth+"px",r.style.height=l.offsetHeight+"px",r.style.position="fixed",r.style.left=d.left+"px",r.style.top=d.top+"px",r.style.pointerEvents="none",r.style.transition="transform .3s",document.body.appendChild(r),setTimeout(function(){r.style.transform="scale(1.2)"},50);var i=function t(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,e.target.removeEventListener("click",t)},a=function(t){t.preventDefault()},s=function e(i){i.preventDefault(),i.target.removeEventListener(t.eventList.TOUCH_MOVE,a),i.target.removeEventListener(t.eventList.TOUCH_END,e)};l.addEventListener("click",i),l.addEventListener(t.eventList.TOUCH_MOVE,a),l.addEventListener(t.eventList.TOUCH_END,s)},n);var m=function(e){var i=t.isMobile()?e.changedTouches[0]:e;(Math.abs(i.clientX-c.clientX)>30||Math.abs(i.clientY-c.clientY)>30)&&clearInterval(a),requestAnimationFrame(function(){if(r){var i=t.isMobile()?e.changedTouches[0]:e,a=document.createEvent("Event");a.initEvent("myDragover",!0,!0),v=document.elementFromPoint(i.pageX,i.pageY),v&&v.dispatchEvent(a),u=a.defaultPrevented,r.style.left=Math.round(i.pageX-(c.pageX-d.left))+"px",r.style.top=Math.round(i.pageY-(c.pageY-d.top))+"px"}})};document.addEventListener(t.eventList.TOUCH_MOVE,m,{passive:!1}),document.addEventListener(t.eventList.TOUCH_END,function(e){if(clearInterval(a),document.removeEventListener(t.eventList.TOUCH_MOVE,m),r){if(u){var s=document.createEvent("Event");s.initEvent("myDrop",!0,!0);var n=t.isMobile()?e.changedTouches[0]:e,c=t.list.find(function(t){return parseInt(l.getAttribute("id"))===t.id});s["pageX"]=n.pageX,s["pageY"]=n.pageY,s["data"]=Object(o["a"])({type:l.getAttribute("type"),url:c.img},c),v.dispatchEvent(s)}document.body.removeChild(r),r=null,window.dispatchEvent(i)}})}})},handleDragEnd:function(t){window.dispatchEvent(window.mydragend),window.dragTarget=null},handleDragStart:function(t,e){t.dataTransfer.setData("type","material"),t.dataTransfer.setData("url",e.img),window.dispatchEvent(window.mydragstart)},replaceImage:function(t){var e=this,i=canvas.getActiveObjects();if(this.matrixShow)this.$toast.message("请先取消变形");else if(0!==i.length)if(i.length>1)this.$toast.message("只能替换单个素材");else if("i-text"!==i[0].type){var a=m()();canvas.getActiveObjects().forEach(function(t){t.goods_id&&e.changeSketchGoods({type:"remove",uid:t.uid}),canvas.remove(t)}),canvas.discardActiveObject().renderAll(),fabric.Image.fromURL(t+"?imageslim&imageView2/0/w/1000",function(t){var s=i[0].scaleX*i[0].width/t.width,n=Object(o["a"])({},i[0],{width:t.width,height:t.height,scaleX:s,scaleY:s,_element:t._element,_originalElement:t._originalElement,uid:a});n.goods_id&&delete n.goods_id,t.set(Object(o["a"])({},n)),canvas.add(t),canvas.setActiveObject(t),e.updateHistory()},{crossOrigin:"anonymous"})}else this.$toast.message("文本不能被替换");else this.$toast.message("请先选中被替换的素材")},addImage:function(t){var e=this,i=m()();fabric.Image.fromURL(t+"?imageslim&imageView2/0/w/1000",function(t){t.set({uid:i}),canvas.add(t),canvas.setActiveObject(t),e.updateHistory()},{crossOrigin:"anonymous"})}}),computed:Object(o["a"])({},Object(u["c"])({styleList:function(t){return t.sketch.styleList},spaceList:function(t){return t.sketch.spaceList},matrixShow:function(t){return t.sketch.matrix.show}})),created:function(){this.getSceneMaterials()},mounted:function(){var t=this;document.addEventListener("click",function(){t.spaceSelect=!1,t.styleSelect=!1}),this.initDrag()}},p=h,g=(i("0716"),i("17cc")),f=Object(g["a"])(p,s,n,!1,null,"4573db81",null);e["default"]=f.exports},d363:function(t,e,i){t.exports=i.p+"static/img/search_img_notf_dis.097ce81b.png"},ec25:function(t,e,i){"use strict";var a=i("7aae"),s=i.n(a);s.a},fd88:function(t,e,i){"use strict";var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"scroller",attrs:{id:"scroller"}},[t._t("default")],2)},s=[],n=(i("d4d5"),{name:"infiniteScroll",props:{distance:{type:Number,default:100},loadMore:{type:Function,required:!0}},methods:{initScroller:function(){var t=this,e=this.$refs.scroller;e.addEventListener("scroll",function(i){var a=e.scrollHeight,s=e.scrollTop,n=e.offsetHeight;a-s-n<100&&t.loadMore()})}},mounted:function(){this.initScroller()}}),c=n,r=(i("c2f0"),i("17cc")),o=Object(r["a"])(c,a,s,!1,null,"0355fe16",null);e["a"]=o.exports}}]);