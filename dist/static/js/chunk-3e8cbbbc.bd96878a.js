(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3e8cbbbc","chunk-31631b6a","chunk-5e04f6b8","chunk-290360f9"],{"05ba":function(e,t){var i="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(i){var n=new Uint8Array(16);e.exports=function(){return i(n),n}}else{var a=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0===(3&t)&&(e=4294967296*Math.random()),a[t]=e>>>((3&t)<<3)&255;return a}}},"0716":function(e,t,i){"use strict";var n=i("9ddb"),a=i.n(n);a.a},"37ea":function(e,t,i){},"3c6b":function(e,t,i){"use strict";var n=i("a013"),a=i("b146"),s=i("b0f4"),r=i("35dd");i("629c")("match",1,function(e,t,i,c){return[function(i){var n=e(this),a=void 0==i?void 0:i[t];return void 0!==a?a.call(i,n):new RegExp(i)[t](String(n))},function(e){var t=c(i,e,this);if(t.done)return t.value;var o=n(e),l=String(this);if(!o.global)return r(o,l);var d=o.unicode;o.lastIndex=0;var u,v=[],m=0;while(null!==(u=r(o,l))){var p=String(u[0]);v[m]=p,""===p&&(o.lastIndex=s(l,a(o.lastIndex),d)),m++}return 0===m?null:v}]})},4964:function(e,t,i){"use strict";function n(e){if(Array.isArray(e)){for(var t=0,i=new Array(e.length);t<e.length;t++)i[t]=e[t];return i}}function a(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function s(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function r(e){return n(e)||a(e)||s()}i.d(t,"a",function(){return r})},5428:function(e,t,i){var n=i("05ba"),a=i("97c1");function s(e,t,i){var s=t&&i||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null),e=e||{};var r=e.random||(e.rng||n)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t)for(var c=0;c<16;++c)t[s+c]=r[c];return t||a(r)}e.exports=s},"97c1":function(e,t){for(var i=[],n=0;n<256;++n)i[n]=(n+256).toString(16).substr(1);function a(e,t){var n=t||0,a=i;return[a[e[n++]],a[e[n++]],a[e[n++]],a[e[n++]],"-",a[e[n++]],a[e[n++]],"-",a[e[n++]],a[e[n++]],"-",a[e[n++]],a[e[n++]],"-",a[e[n++]],a[e[n++]],a[e[n++]],a[e[n++]],a[e[n++]],a[e[n++]]].join("")}e.exports=a},"9ddb":function(e,t,i){},c2f0:function(e,t,i){"use strict";var n=i("37ea"),a=i.n(n);a.a},c6c1:function(e,t,i){"use strict";i.r(t);var n,a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{ref:"materials",staticClass:"material"},[n("div",{staticClass:"filter"},[n("div",{staticClass:"select"},[n("div",{staticClass:"select-value",on:{click:function(t){return t.stopPropagation(),e.toggleSpaceSelect(t)}}},[e._v(e._s(e.selectedSpace||"选择空间"))]),n("transition",{attrs:{name:"expand"}},[n("div",{directives:[{name:"show",rawName:"v-show",value:e.spaceSelect,expression:"spaceSelect"}],staticClass:"select-dropdown"},[n("div",{staticClass:"select-option",on:{click:function(t){return e.selectSpace("")}}},[e._v("全部")]),e._l(e.spaceList,function(t){return n("div",{staticClass:"select-option",class:{active:e.selectedSpace===t.name},on:{click:function(i){return e.selectSpace(t.name)}}},[e._v(e._s(t.name))])})],2)])],1),n("div",{staticClass:"select"},[n("div",{staticClass:"select-value",on:{click:function(t){return t.stopPropagation(),e.toggleStyleSelect(t)}}},[e._v(e._s(e.selectedStyle||"选择风格"))]),n("transition",{attrs:{name:"expand"}},[n("div",{directives:[{name:"show",rawName:"v-show",value:e.styleSelect,expression:"styleSelect"}],staticClass:"select-dropdown"},[n("div",{staticClass:"select-option",on:{click:function(t){return e.selectStyle("")}}},[e._v("全部")]),e._l(e.styleList,function(t){return n("div",{staticClass:"select-option",class:{active:e.selectedStyle===t.name},on:{click:function(i){return e.selectStyle(t.name)}}},[e._v(e._s(t.name))])})],2)])],1)]),n("div",{staticClass:"material-container"},[e.list.length?n("infiniteScroll",{staticClass:"material-list",attrs:{loadMore:e.loadMore}},e._l(e.list,function(t){return n("div",{staticClass:"material-item"},[n("div",{staticClass:"material-item-img",style:{"background-image":"url("+t.img+"?imageslim&imageView2/0/w/765)"},attrs:{id:t.id,type:"material"}}),n("div",{staticClass:"material-item-cell"},[n("div",{staticClass:"material-item-info"},[e._v("点击添加到画布…")]),n("div",{staticClass:"material-item-collection",on:{click:function(i){return i.stopPropagation(),e.collectionMaterial(t)}}},[t.is_collection?n("i",{staticClass:"icon-collection_active"}):n("i",{staticClass:"icon-collection"})])]),n("div",{staticClass:"material-item-btns"},[n("div",{staticClass:"material-item-btn",on:{click:function(i){return e.replaceImage(t.img)}}},[e._v("替换")]),n("div",{staticClass:"material-item-btn",on:{click:function(i){return e.addImage(t.img)}}},[e._v("添加")])])])}),0):n("div",{staticClass:"material-list"},[n("div",{staticClass:"material-list-info"},[n("img",{attrs:{src:i("d363")}}),n("div",{staticClass:"material-list-info-txt"},[e._v("未找到相关素材")])])])],1)])},s=[],r=(i("f763"),i("608b"),i("3c6b"),i("4964")),c=(i("4453"),i("089b")),o=i("e20c"),l=i("880a"),d=i("fd88"),u=i("591a"),v=i("5428"),m=i.n(v),p={name:"myMaterial",data:function(){return{list:[],pageCode:0,isLoading:!1,isLoaded:!1,spaceSelect:!1,styleSelect:!1,selectedStyle:"",selectedSpace:"",eventList:{TOUCH_START:this.isMobile()?"touchstart":"mousedown",TOUCH_MOVE:this.isMobile()?"touchmove":"mousemove",TOUCH_END:this.isMobile()?"touchend":"mouseup"}}},components:{infiniteScroll:d["a"]},watch:{selectedStyle:function(){this.getSceneMaterials()},selectedSpace:function(){this.getSceneMaterials()}},methods:Object(o["a"])({},Object(u["b"])(["changeSketchGoods","updateHistory"]),{collectionMaterial:function(){var e=Object(c["a"])(regeneratorRuntime.mark(function e(t){var i,n,a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(e.prev=0,i=t.is_collection,n=t.id,!i){e.next=7;break}return e.next=5,this.$axios.get(l["unCollectionMaterial"],{params:{id:n}});case 5:e.next=9;break;case 7:return e.next=9,this.$axios.get(l["collectionMaterial"],{params:{id:n}});case 9:this.$set(t,"is_collection",!i),e.next=16;break;case 12:e.prev=12,e.t0=e["catch"](0),a=e.t0.msg,this.$toast.error(a);case 16:case"end":return e.stop()}},e,this,[[0,12]])}));function t(t){return e.apply(this,arguments)}return t}(),selectSpace:function(e){this.selectedSpace=e},selectStyle:function(e){this.selectedStyle=e},toggleSpaceSelect:function(){this.spaceSelect=!this.spaceSelect},toggleStyleSelect:function(){this.styleSelect=!this.styleSelect},getSceneMaterials:function(){var e=Object(c["a"])(regeneratorRuntime.mark(function e(){var t,i,n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$axios.get(l["getSceneMaterials"],{params:{my:1,style:this.selectedStyle,space:this.selectedSpace}});case 3:t=e.sent,i=t.data,this.pageCode=i.page_code,this.list=i.ls,this.isLoaded=!1,e.next=14;break;case 10:e.prev=10,e.t0=e["catch"](0),n=e.t0.msg,this.$toast.error(n);case 14:case"end":return e.stop()}},e,this,[[0,10]])}));function t(){return e.apply(this,arguments)}return t}(),loadMore:function(){var e=Object(c["a"])(regeneratorRuntime.mark(function e(){var t,i,n,a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(e.prev=0,!this.isLoading&&!this.isLoaded){e.next=3;break}return e.abrupt("return");case 3:return this.isLoading=!0,e.next=6,this.$axios.get(l["getSceneMaterials"],{params:{my:1,page_code:this.pageCode,style:this.selectedStyle,space:this.selectedSpace}});case 6:i=e.sent,n=i.data,(t=this.list).push.apply(t,Object(r["a"])(n.ls)),this.pageCode=n.page_code,this.isLoaded=!n.ls.length,this.isLoading=!1,e.next=19;break;case 14:e.prev=14,e.t0=e["catch"](0),a=e.t0.msg,this.isLoading=!1,this.$toast.error(a);case 19:case"end":return e.stop()}},e,this,[[0,14]])}));function t(){return e.apply(this,arguments)}return t}(),isMobile:function(){return!!(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i))},initDrag:function(){var e=this,t=new CustomEvent("mydragstart"),i=new CustomEvent("mydragend");this.$refs.materials.addEventListener(this.eventList.TOUCH_START,function(a){if(a.cancelable&&-1!==a.target.className.indexOf("material-item-img")){clearInterval(n);var s=500,r=e.isMobile()?a.changedTouches[0]:a,c=null,l=a.target,d=l.getBoundingClientRect(),u=!1,v=null;n=setTimeout(function(){window.dispatchEvent(t),c=l.cloneNode(!0),c.style.width=l.offsetWidth+"px",c.style.height=l.offsetHeight+"px",c.style.position="fixed",c.style.left=d.left+"px",c.style.top=d.top+"px",c.style.pointerEvents="none",c.style.transition="transform .3s",document.body.appendChild(c),setTimeout(function(){c.style.transform="scale(1.2)"},50);var i=function e(t){t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,t.target.removeEventListener("click",e)},n=function(e){e.preventDefault()},a=function t(i){i.preventDefault(),i.target.removeEventListener(e.eventList.TOUCH_MOVE,n),i.target.removeEventListener(e.eventList.TOUCH_END,t)};l.addEventListener("click",i),l.addEventListener(e.eventList.TOUCH_MOVE,n),l.addEventListener(e.eventList.TOUCH_END,a)},s);var m=function(t){var i=e.isMobile()?t.changedTouches[0]:t;(Math.abs(i.clientX-r.clientX)>30||Math.abs(i.clientY-r.clientY)>30)&&clearInterval(n),requestAnimationFrame(function(){if(c){var i=e.isMobile()?t.changedTouches[0]:t,n=document.createEvent("Event");n.initEvent("myDragover",!0,!0),v=document.elementFromPoint(i.pageX,i.pageY),v&&v.dispatchEvent(n),u=n.defaultPrevented,c.style.left=Math.round(i.pageX-(r.pageX-d.left))+"px",c.style.top=Math.round(i.pageY-(r.pageY-d.top))+"px"}})};document.addEventListener(e.eventList.TOUCH_MOVE,m,{passive:!1}),document.addEventListener(e.eventList.TOUCH_END,function(t){if(clearInterval(n),document.removeEventListener(e.eventList.TOUCH_MOVE,m),c){if(u){var a=document.createEvent("Event");a.initEvent("myDrop",!0,!0);var s=e.isMobile()?t.changedTouches[0]:t,r=e.list.find(function(e){return parseInt(l.getAttribute("id"))===e.id});a["pageX"]=s.pageX,a["pageY"]=s.pageY,a["data"]=Object(o["a"])({type:l.getAttribute("type"),url:r.img},r),v.dispatchEvent(a)}document.body.removeChild(c),c=null,window.dispatchEvent(i)}})}})},handleDragEnd:function(e){window.dispatchEvent(window.mydragend),window.dragTarget=null},handleDragStart:function(e,t){e.dataTransfer.setData("type","material"),e.dataTransfer.setData("url",t.img),window.dispatchEvent(window.mydragstart)},replaceImage:function(e){var t=this,i=canvas.getActiveObjects();if(this.matrixShow)this.$toast.message("请先取消变形");else if(0!==i.length)if(i.length>1)this.$toast.message("只能替换单个素材");else if("i-text"!==i[0].type){var n=m()();canvas.getActiveObjects().forEach(function(e){e.goods_id&&t.changeSketchGoods({type:"remove",uid:e.uid}),canvas.remove(e)}),canvas.discardActiveObject().renderAll(),fabric.Image.fromURL(e+"?imageslim&imageView2/0/w/1000",function(e){var a=i[0].scaleX*i[0].width/e.width,s=Object(o["a"])({},i[0],{width:e.width,height:e.height,scaleX:a,scaleY:a,_element:e._element,_originalElement:e._originalElement,uid:n});s.goods_id&&delete s.goods_id,e.set(Object(o["a"])({},s)),canvas.add(e),canvas.setActiveObject(e),t.updateHistory()},{crossOrigin:"anonymous"})}else this.$toast.message("文本不能被替换");else this.$toast.message("请先选中被替换的素材")},addImage:function(e){var t=this,i=m()();fabric.Image.fromURL(e+"?imageslim&imageView2/0/w/1000",function(e){e.set({uid:i}),canvas.add(e),canvas.setActiveObject(e),t.updateHistory()},{crossOrigin:"anonymous"})}}),computed:Object(o["a"])({},Object(u["c"])({styleList:function(e){return e.sketch.styleList},spaceList:function(e){return e.sketch.spaceList},matrixShow:function(e){return e.sketch.matrix.show}})),created:function(){this.getSceneMaterials()},mounted:function(){var e=this;document.addEventListener("click",function(){e.spaceSelect=!1,e.styleSelect=!1}),this.initDrag()}},f=p,g=(i("0716"),i("17cc")),h=Object(g["a"])(f,a,s,!1,null,"4573db81",null);t["default"]=h.exports},d363:function(e,t,i){e.exports=i.p+"static/img/search_img_notf_dis.097ce81b.png"},fd88:function(e,t,i){"use strict";var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{ref:"scroller",attrs:{id:"scroller"}},[e._t("default")],2)},a=[],s=(i("d4d5"),{name:"infiniteScroll",props:{distance:{type:Number,default:100},loadMore:{type:Function,required:!0}},methods:{initScroller:function(){var e=this,t=this.$refs.scroller;t.addEventListener("scroll",function(i){var n=t.scrollHeight,a=t.scrollTop,s=t.offsetHeight;n-a-s<100&&e.loadMore()})}},mounted:function(){this.initScroller()}}),r=s,c=(i("c2f0"),i("17cc")),o=Object(c["a"])(r,n,a,!1,null,"0355fe16",null);t["a"]=o.exports}}]);