(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4dead3c4"],{"9bb9":function(e,t,i){"use strict";var a=i("ef3c"),n=i.n(a);n.a},e814:function(e,t,i){"use strict";i.r(t);var a,n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("transition",{attrs:{name:"detail"}},[a("div",{staticClass:"detail"},[e.showSearchInput?a("div",{staticClass:"detail-header"},[a("div",{staticClass:"detail-back",on:{click:e.back}},[a("div",{staticClass:"iconfont icon-back-1"}),a("div",{staticClass:"detail-header-title"},[e._v("返回")])]),a("div",{staticClass:"detail-search-header"},[a("div",{staticClass:"search"},[a("div",{staticClass:"search-icon icon-search"}),a("input",{directives:[{name:"model",rawName:"v-model",value:e.keyword,expression:"keyword"}],staticClass:"search-input",attrs:{placeholder:"请输入搜索内容"},domProps:{value:e.keyword},on:{input:function(t){t.target.composing||(e.keyword=t.target.value)}}}),e.keyword?a("div",{staticClass:"search-clear",on:{click:e.clearKeyword}},[a("div",{staticClass:"icon-close"})]):e._e()]),a("div",{staticClass:"filter",on:{click:e.showScreening}},[a("div",{staticClass:"icon-filter"}),a("p",[e._v("筛选")])])])]):a("div",{staticClass:"detail-header"},[a("div",{staticClass:"detail-back",on:{click:e.close}},[a("div",{staticClass:"iconfont icon-close"})]),a("div",{staticClass:"detail-info"},[a("div",{staticClass:"detail-brand-info"},[a("div",{staticClass:"detail-brand-logo",style:{"background-image":"url("+e.brandDetail.logo+")"}}),a("div",{staticClass:"detail-brand-name"},[e._v(e._s(e.brandDetail.name))])]),a("div",{staticClass:"detail-search",on:{click:e.changeSearch}},[a("div",{staticClass:"icon-search"}),a("div",{staticClass:"detail-search-text"},[e._v("搜索")])])])]),a("infinite-scroll",{directives:[{name:"show",rawName:"v-show",value:e.brandGoods.length,expression:"brandGoods.length"}],ref:"brandList",staticClass:"goods-content",attrs:{loadMore:e.loadMore}},e._l(e.brandGoods,function(t){return a("div",{staticClass:"goods-body"},[a("div",{key:t.goods_id,staticClass:"good-item",on:{click:function(i){return e.openGoodDetail(t.goods_id,t.key,"brandGoods")}}},[a("div",{staticClass:"good-btns"},[a("div",{staticClass:"good-btn",on:{click:function(i){return i.stopPropagation(),e.replaceImage(t.original_img,t)}}},[e._v("替换")]),a("div",{staticClass:"good-btn",on:{click:function(i){return i.stopPropagation(),e.addImage(t.original_img,t)}}},[e._v("添加")])]),a("div",{staticClass:"good-img",style:{"background-image":"url("+t.original_img+"?imageslim&imageView2/0/w/560)"},attrs:{id:t.goods_id,type:"good",source:"brandGoods"}}),a("div",{staticClass:"good-cell"},[a("div",{staticClass:"good-money-vip"},[a("em",[e._v("¥"+e._s(t.shop_price))]),a("span",[e._v("会员")])]),t.is_collection?a("i",{staticClass:"icon-collection_active",on:{click:function(i){return i.stopPropagation(),e.collectionGood(t)}}}):a("i",{staticClass:"icon-collection",on:{click:function(i){return i.stopPropagation(),e.collectionGood(t)}}})]),a("div",{staticClass:"good-money"},[a("span",[e._v("零售价")]),a("em",[e._v("¥"+e._s(t.market_price))])]),a("p",{staticClass:"good-name"},[e._v(e._s(t.goods_name))])])])}),0),e.brandGoods.length?e._e():a("div",{staticClass:"goods-content-info"},[a("img",{attrs:{src:i("d363")}}),a("div",{staticClass:"brand-list-info-text"},[e._v("未找到相关商品")])]),a("brand-goods-detail")],1)])},s=[],o=(i("608b"),i("3c6b"),i("4964")),r=(i("f763"),i("4453"),i("089b")),c=i("e20c"),d=(i("d4d5"),i("880a")),l=i("fd88"),g=i("5143"),h=i("591a"),u=i("5428"),v=i.n(u),p={name:"brandDetail",props:{brandId:[String,Number]},components:{infiniteScroll:l["a"],brandGoodsDetail:g["default"]},data:function(){return{eventList:{TOUCH_START:this.isMobile()?"touchstart":"mousedown",TOUCH_MOVE:this.isMobile()?"touchmove":"mousemove",TOUCH_END:this.isMobile()?"touchend":"mouseup"},showSearchInput:!1,page:1,pageSize:20,keyword:"",brandDetail:{},brandGoods:[]}},computed:Object(c["a"])({},Object(h["c"])({matrix:function(e){return e.sketch.matrix},brandScreening:function(e){return e.sketch.brandScreening},screeningConfirm:function(e){return e.sketch.brandScreeningConfirm.confirmed}})),watch:{keyword:function(e){this.page=1,this.getBrandGoods()},screeningConfirm:function(e){e&&(this.changeBrandScreeningConfirm({confirmed:!1}),this.getBrandGoods())}},methods:Object(c["a"])({},Object(h["b"])(["changeBrandScreening","changeBrandGoodsDetail","changeBrandScreeningConfirm"]),{showScreening:function(){this.changeBrandScreening({show:!0,brandId:this.brandDetail.id})},changeSearch:function(){this.showSearchInput=!0},close:function(){this.$emit("closeBrandDetail")},back:function(){this.keyword="",this.changeBrandScreening({show:!1,search_words:"",brandId:"",first_id:"",second_id:"",three_id:"",category_id:""}),this.getBrandGoods(),this.showSearchInput=!1},clearKeyword:function(){this.keyword=""},openGoodDetail:function(e,t,i){this.changeBrandGoodsDetail({show:!0,id:e,key:t,dataSource:i})},collectionGood:function(){var e=Object(r["a"])(regeneratorRuntime.mark(function e(t){var i,a,n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(e.prev=0,i=t.is_collection,a=t.goods_id,!i){e.next=7;break}return e.next=5,this.$axios.get(d["unCollection"],{params:{goods_id:a}});case 5:e.next=9;break;case 7:return e.next=9,this.$axios.get(d["setCollection"],{params:{goods_id:a}});case 9:this.$set(t,"is_collection",!i),e.next=16;break;case 12:e.prev=12,e.t0=e["catch"](0),n=e.t0.msg,this.$toast.error(n);case 16:case"end":return e.stop()}},e,this,[[0,12]])}));function t(t){return e.apply(this,arguments)}return t}(),addImage:function(e,t){var i=this,a=v()();fabric.Image.fromURL(e+"?imageslim&imageView2/0/w/1000",function(e){e.set({goods_id:t.goods_id,goods_key:t.key,left:100,top:100,uid:a}),e.scaleToWidth(300),canvas.add(e),canvas.setActiveObject(e),i.changeSketchGoods({type:"set",good:Object(c["a"])({},t,{uid:a})}),i.updateHistory()},{crossOrigin:"anonymous"})},replaceImage:function(e,t){var i=this;if(this.matrix.show)this.$toast.message("请先取消变形");else{var a=canvas.getActiveObjects();if(0!==a.length)if(a.length>1)this.$toast.message("只能替换单个商品");else if("i-text"!==a[0].type){var n=v()();canvas.getActiveObjects().forEach(function(e){e.goods_id&&i.changeSketchGoods({type:"remove",uid:e.uid}),canvas.remove(e)}),canvas.discardActiveObject().renderAll(),fabric.Image.fromURL(e+"?imageslim&imageView2/0/w/1000",function(e){var s=a[0].scaleX*a[0].width/e.width,o=Object(c["a"])({},a[0],{width:e.width,height:e.height,scaleX:s,scaleY:s,_element:e._element,_originalElement:e._originalElement,goods_id:t.goods_id,goods_key:t.key,uid:n});e.set(Object(c["a"])({},o)),canvas.add(e),canvas.setActiveObject(e),i.changeSketchGoods({type:"set",good:Object(c["a"])({},t,{uid:n})}),i.updateHistory()},{crossOrigin:"anonymous"})}else this.$toast.message("文本不能被替换");else this.$toast.message("请先选中被替换的单品")}},loadMore:function(){var e=Object(r["a"])(regeneratorRuntime.mark(function e(){var t,i,a,n,s=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(e.prev=0,!this.isLoading&&!this.isLoaded){e.next=3;break}return e.abrupt("return");case 3:return this.isLoading=!0,e.next=6,this.$axios.get(d["brandGoods"],{params:{is_sku:1,keyword:this.keyword,brand_id:this.brandId,page:this.page,page_size:this.pageSize}});case 6:i=e.sent,a=i.data,this.page+=1,(t=this.brandGoods).push.apply(t,Object(o["a"])(a.goods)),a.goods.length||(this.isLoaded=!0),this.$nextTick(function(){s.isLoading=!1}),e.next=19;break;case 14:e.prev=14,e.t0=e["catch"](0),n=e.t0.msg,this.isLoading=!1,this.$toast.error(n);case 19:case"end":return e.stop()}},e,this,[[0,14]])}));function t(){return e.apply(this,arguments)}return t}(),getBrandGoods:function(){var e=Object(r["a"])(regeneratorRuntime.mark(function e(){var t,i;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,this.page=1,e.next=4,this.$axios.get(d["brandGoods"],{params:{brand_id:this.brandId,is_sku:1,keyword:this.keyword,page:this.page,page_size:this.pageSize,category_id:this.brandScreening.category_id||""}});case 4:t=e.sent,i=t.data,this.brandDetail=i.brand,this.brandGoods=i.goods,this.isLoading=!1,this.isLoaded=!1,this.page+=1,e.next=16;break;case 13:e.prev=13,e.t0=e["catch"](0),this.$toast.error(e.t0.msg);case 16:case"end":return e.stop()}},e,this,[[0,13]])}));function t(){return e.apply(this,arguments)}return t}(),isMobile:function(){return!!(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i))},initDrag:function(){var e=this,t=new CustomEvent("mydragstart"),i=new CustomEvent("mydragend");this.$refs.brandList.$el.addEventListener(this.eventList.TOUCH_START,function(n){if(n.cancelable&&-1!==n.target.className.indexOf("good-img")){clearInterval(a);var s=500,o=e.isMobile()?n.changedTouches[0]:n,r=null,d=n.target,l=d.getBoundingClientRect(),g=!1,h=null;a=setTimeout(function(){window.dispatchEvent(t),r=d.cloneNode(!0),r.style.width=d.offsetWidth+"px",r.style.height=d.offsetHeight+"px",r.style.position="fixed",r.style.left=l.left+"px",r.style.top=l.top+"px",r.style.pointerEvents="none",r.style.transition="transform .3s",document.body.appendChild(r),setTimeout(function(){r.style.transform="scale(1.2)"},50);var i=function e(t){t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,t.target.removeEventListener("click",e)},a=function(e){e.preventDefault()},n=function t(i){i.preventDefault(),i.target.removeEventListener(e.eventList.TOUCH_MOVE,a),i.target.removeEventListener(e.eventList.TOUCH_END,t)};d.addEventListener("click",i),d.addEventListener(e.eventList.TOUCH_MOVE,a),d.addEventListener(e.eventList.TOUCH_END,n)},s);var u=function(t){var i=e.isMobile()?t.changedTouches[0]:t;(Math.abs(i.clientX-o.clientX)>30||Math.abs(i.clientY-o.clientY)>30)&&clearInterval(a),requestAnimationFrame(function(){if(r){t.preventDefault();var i=e.isMobile()?t.changedTouches[0]:t,a=document.createEvent("Event");a.initEvent("myDragover",!0,!0),h=document.elementFromPoint(i.pageX,i.pageY),h&&h.dispatchEvent(a),g=a.defaultPrevented,r.style.left=Math.round(i.pageX-(o.pageX-l.left))+"px",r.style.top=Math.round(i.pageY-(o.pageY-l.top))+"px"}})};document.addEventListener(e.eventList.TOUCH_MOVE,u),document.addEventListener(e.eventList.TOUCH_END,function(t){if(clearInterval(a),document.removeEventListener(e.eventList.TOUCH_MOVE,u),r){if(t.preventDefault(),g){var n=document.createEvent("Event");n.initEvent("myDrop",!0,!0);var s=e.isMobile()?t.changedTouches[0]:t,o=d.getAttribute("source"),l={};l=e[o].find(function(e){return parseInt(d.getAttribute("id"))===e.goods_id}),n["pageX"]=s.pageX,n["pageY"]=s.pageY,n["data"]=Object(c["a"])({type:d.getAttribute("type"),url:l.original_img},l),h.dispatchEvent(n)}document.body.removeChild(r),r=null,window.dispatchEvent(i)}})}})}}),created:function(){this.getBrandGoods()},mounted:function(){this.initDrag()}},m=p,f=(i("9bb9"),i("17cc")),b=Object(f["a"])(m,n,s,!1,null,"2b7a5300",null);t["default"]=b.exports},ef3c:function(e,t,i){}}]);